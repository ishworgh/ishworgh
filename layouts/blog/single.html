{{ define "main" }}
<div class="max-w-7xl mx-auto py-12 px-4">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

        <!-- Main Content -->
        <div class="lg:col-span-3">
            <article>
                <!-- Header -->
                <header class="mb-12 text-center border-b border-border pb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-primary">{{ .Title }}</h1>
                    <div class="flex items-center justify-center gap-4 text-sm text-secondary">
                        <time class="flex items-center gap-1">
                            <i data-feather="calendar" class="w-4 h-4"></i>
                            {{ .Date.Format "January 02, 2006" }}
                        </time>
                        <span>â€¢</span>
                        <span class="flex items-center gap-1">
                            <i data-feather="clock" class="w-4 h-4"></i>
                            {{ .ReadingTime }} min read
                        </span>
                    </div>
                </header>

                <!-- Featured Image -->
                {{ $images := .Resources.ByType "image" }}
                {{ $cover := $images.GetMatch "*cover*" }}
                {{ if not $cover }}{{ $cover = $images.GetMatch "*feature*" }}{{ end }}
                {{ if $cover }}
                <div class="mb-12 rounded-2xl overflow-hidden shadow-2xl">
                    <img src="{{ $cover.RelPermalink }}" alt="{{ .Title }}" class="w-full h-auto">
                </div>
                {{ end }}

                <!-- Content with Prose -->
                <div class="prose prose-lg max-w-none
                    prose-headings:text-primary prose-headings:font-bold
                    prose-h1:text-4xl prose-h1:mb-6 prose-h1:mt-10
                    prose-h2:text-3xl prose-h2:mb-4 prose-h2:mt-8 prose-h2:border-b prose-h2:border-border prose-h2:pb-2
                    prose-h3:text-2xl prose-h3:mb-3 prose-h3:mt-6
                    prose-p:text-text prose-p:leading-relaxed prose-p:mb-4
                    prose-a:text-accent prose-a:no-underline hover:prose-a:underline hover:prose-a:text-primary
                    prose-strong:text-text prose-strong:font-bold
                    prose-em:text-text prose-em:italic
                    prose-code:text-accent prose-code:bg-surface prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:before:content-[''] prose-code:after:content-[''] prose-code:break-words
                    prose-pre:bg-surface prose-pre:border prose-pre:border-border prose-pre:rounded-xl prose-pre:p-4 prose-pre:overflow-x-auto prose-pre:max-w-full
                    prose-ul:my-4 prose-ul:list-disc prose-ul:pl-6
                    prose-ol:my-4 prose-ol:list-decimal prose-ol:pl-6
                    prose-li:text-text prose-li:mb-2
                    prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:pl-4 prose-blockquote:italic prose-blockquote:text-text
                    prose-img:rounded-xl prose-img:shadow-lg prose-img:my-8
                    prose-hr:border-border prose-hr:my-8
                    prose-table:border-collapse prose-table:w-full
                    prose-th:bg-surface prose-th:border prose-th:border-border prose-th:p-2 prose-th:text-left prose-th:text-text
                    prose-td:border prose-td:border-border prose-td:p-2 prose-td:text-text
                    ">
                    {{ .Content }}
                </div>

                <!-- Post Footer -->
                <footer class="mt-16 pt-8 border-t border-border">
                    <div class="flex items-center justify-between">
                        <a href="/blog/"
                            class="flex items-center gap-2 text-secondary hover:text-primary transition-colors">
                            <i data-feather="arrow-left" class="w-4 h-4"></i> Back to Blog
                        </a>
                        {{ if .Params.tags }}
                        <div class="flex gap-2">
                            {{ range .Params.tags }}
                            <span
                                class="px-3 py-1 bg-surface border border-border rounded-full text-sm text-secondary">{{
                                . }}</span>
                            {{ end }}
                        </div>
                        {{ end }}
                    </div>
                </footer>
            </article>
        </div>

        <!-- Sidebar with TOC -->
        <aside class="lg:col-span-1 hidden lg:block">
            <div class="sticky top-24">
                <div class="bg-surface rounded-xl border border-border p-6 shadow-sm">
                    <h3
                        class="text-sm font-bold text-secondary uppercase tracking-wider mb-4 pb-2 border-b border-border">
                        Table of Contents
                    </h3>
                    <nav class="toc text-sm space-y-1">
                        {{ .TableOfContents }}
                    </nav>
                </div>
            </div>
        </aside>
    </div>
</div>

<!-- Custom Styles for Code Blocks -->
<style>
    /* Fix code block overflow */
    article pre {
        overflow-x: auto !important;
        max-width: 100% !important;
        position: relative;
        background-color: var(--surface-color) !important;
        border: 1px solid var(--border-color) !important;
    }

    article pre code {
        display: block !important;
        white-space: pre !important;
        overflow-x: auto !important;
        max-width: 100% !important;
        color: var(--text-color) !important;
        background: transparent !important;
    }

    /* Inline code */
    article :not(pre)>code {
        background-color: var(--surface-color) !important;
        color: var(--accent-color) !important;
        border: 1px solid var(--border-color) !important;
    }

    /* Links in code blocks - more specific selectors */
    article pre a,
    article code a,
    article.prose pre a,
    article.prose code a,
    .prose pre a,
    .prose code a {
        color: var(--primary-color) !important;
        text-decoration: underline !important;
    }

    article pre a:hover,
    article code a:hover,
    article.prose pre a:hover,
    article.prose code a:hover,
    .prose pre a:hover,
    .prose code a:hover {
        color: var(--accent-color) !important;
    }

    /* Copy button styling */
    .copy-code-button {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        padding: 0.5rem;
        background: var(--primary-color);
        color: var(--bg-color);
        border: none;
        border-radius: 0.375rem;
        cursor: pointer;
        opacity: 0;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        width: 2rem;
        height: 2rem;
    }

    article pre:hover .copy-code-button {
        opacity: 1;
    }

    .copy-code-button:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .copy-code-button.copied {
        background: var(--accent-color);
    }

    /* TOC Styling */
    .toc ul {
        list-style: none;
        padding-left: 0;
        margin: 0;
    }

    .toc li {
        margin: 0;
    }

    .toc a {
        display: block;
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        color: var(--secondary-color);
        text-decoration: none;
        transition: all 0.2s;
    }

    .toc a:hover {
        color: var(--primary-color);
        background-color: var(--bg-color);
        transform: translateX(4px);
    }

    .toc>ul>li>ul {
        padding-left: 0.75rem;
        margin-top: 0.25rem;
    }
</style>

<!-- Add Copy Buttons to Code Blocks -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Add copy buttons to all code blocks
        const codeBlocks = document.querySelectorAll('pre > code');

        codeBlocks.forEach((codeBlock) => {
            const pre = codeBlock.parentElement;

            // Create copy button
            const button = document.createElement('button');
            button.className = 'copy-code-button';
            button.setAttribute('aria-label', 'Copy code');
            button.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
            `;

            // Add click handler
            button.addEventListener('click', async () => {
                const code = codeBlock.textContent;

                try {
                    await navigator.clipboard.writeText(code);
                    button.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    `;
                    button.classList.add('copied');

                    setTimeout(() => {
                        button.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        `;
                        button.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy:', err);
                }
            });

            pre.appendChild(button);
        });
    });
</script>
{{ end }}